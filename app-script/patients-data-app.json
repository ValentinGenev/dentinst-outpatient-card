{"files":[{"id":"7926aaea-c1da-421a-af8f-1333f5a63f6a","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Europe/Sofia\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"MYSELF\"\n  }\n}"},{"id":"1b92377f-5717-45c4-8d17-648065f0a404","name":"0-schemas","type":"server_js","source":"const PATIENTS_COLUMNS \u003d {\n  name: 0,\n  id: 1\n}\n\nconst PATIENTS_DATA_COLUMNS \u003d {\n  patientId: 0,\n  name: 1,\n  middleName: 2,\n  familyName: 3,\n  phone: 4,\n  egn: 5,\n  city: 6,\n  street: 7,\n  occupation: 8,\n  email: 9,\n  hasAllergies: 10,\n  isSmoker: 11\n}\n\nconst MEDICAL_HISTORY_COLUMNS \u003d {\n  patientId: 0,\n  hasRegularMedicationIntake: 1,\n  regularMedications: 2,\n  hasAllergies: 3,\n  allergies: 4,\n  hasBronchialAsthma: 5,\n  hasAids: 6,\n  hasViralHepatitis: 7,\n  hasHemophilia: 8,\n  doesDrugs: 9,\n  hasLeukemia: 10,\n  hasAbnormalBloodPressure: 11,\n  regularBloodPressureMeasures: 12,\n  bloodPressureUntilIncident: 13,\n  hasCardiovascularSystemDiseases: 14,\n  hasDiabetes: 15,\n  hasJointDiseases: 16,\n  isPregnant: 17,\n  hasOtherDiseases: 18,\n  otherDiseases: 19\n}\n\nconst VISITS_COLUMNS \u003d {\n  patientId: 0,\n  id: 1,\n  date: 2\n}"},{"id":"b6dba4b6-5c6b-47b4-90dd-09f2ed84085a","name":"0-sheets","type":"server_js","source":"const PROPERTIES \u003d PropertiesService.getScriptProperties()\nconst SHEET_ID \u003d PROPERTIES.getProperty(\u0027SHEET_ID\u0027)\n\nconst PATIENTS_SHEET_ID \u003d PROPERTIES.getProperty(\u0027PATIENTS_SHEET\u0027)\nconst PATIENTS_DATA_SHEET_ID \u003d PROPERTIES.getProperty(\u0027PATIENTS_DATA_SHEET\u0027)\nconst MEDICAL_HISTORY_SHEET_ID \u003d PROPERTIES.getProperty(\u0027MEDICAL_HISTORY_SHEET\u0027)\nconst VISITS_SHEET_ID \u003d PROPERTIES.getProperty(\u0027VISITS_SHEET\u0027)\n\nconst PATIENTS_SHEET \u003d SpreadsheetApp.openById(SHEET_ID).getSheetByName(PATIENTS_SHEET_ID)\nconst PATIENTS_DATA_SHEET \u003d SpreadsheetApp.openById(SHEET_ID).getSheetByName(PATIENTS_DATA_SHEET_ID)\nconst MEDICAL_HISTORY_SHEET \u003d SpreadsheetApp.openById(SHEET_ID).getSheetByName(MEDICAL_HISTORY_SHEET_ID)\nconst VISITS_SHEET \u003d SpreadsheetApp.openById(SHEET_ID).getSheetByName(VISITS_SHEET_ID)\n"},{"id":"9038241a-817b-4c20-a754-6cc6335cc0e1","name":"0-utilities","type":"server_js","source":"function formatDate(timestamp) {\n  const year \u003d timestamp.getFullYear()\n  const month \u003d (\"0\" + (timestamp.getMonth() + 1)).slice(-2) // Months are zero-based\n  const day \u003d (\"0\" + timestamp.getDate()).slice(-2)\n  const hours \u003d (\"0\" + timestamp.getHours()).slice(-2)\n  const minutes \u003d (\"0\" + timestamp.getMinutes()).slice(-2)\n  const seconds \u003d (\"0\" + timestamp.getSeconds()).slice(-2)\n\n  return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`\n}\n\nfunction loadTemplate(name) {\n  return HtmlService.createHtmlOutputFromFile(name).getContent()\n}\n\nfunction findRowsByValue(sheet, value) {\n  const textFinder \u003d sheet.createTextFinder(value)\n  const matches \u003d textFinder.findAll()\n  \n  const matchingRows \u003d [];\n  for (let i \u003d 0; i \u003c matches.length; i++) {\n    const row \u003d matches[i].getRow()\n    const range \u003d sheet.getRange(row, 1, 1, sheet.getLastColumn())\n    const values \u003d range.getValues()\n    \n    matchingRows.push(values[0])\n  }\n  \n  return matchingRows\n}"},{"id":"0b161b24-74df-4185-b581-5d4a532d4b8d","name":"1-MedicalHistoryMapper","type":"server_js","source":"class MedicalHistoryMapper {\n  static mapDataToTable(id, data) {\n    const medicalHistory \u003d []\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.patientId] \u003d id\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.hasRegularMedicationIntake] \u003d data.hasRegularMedicationIntake\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.regularMedications] \u003d data.regularMedications\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.hasAllergies] \u003d data.hasAllergies\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.allergies] \u003d data.allergies\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.hasBronchialAsthma] \u003d data.hasBronchialAsthma\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.hasAids] \u003d data.hasAids\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.hasViralHepatitis] \u003d data.hasViralHepatitis\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.hasHemophilia] \u003d data.hasHemophilia\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.doesDrugs] \u003d data.doesDrugs\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.hasLeukemia] \u003d data.hasLeukemia\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.hasAbnormalBloodPressure] \u003d data.hasAbnormalBloodPressure\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.regularBloodPressureMeasures] \u003d data.regularBloodPressureMeasures\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.bloodPressureUntilIncident] \u003d data.bloodPressureUntilIncident\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.hasCardiovascularSystemDiseases] \u003d data.hasCardiovascularSystemDiseases\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.hasDiabetes] \u003d data.hasDiabetes\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.hasJointDiseases] \u003d data.hasJointDiseases\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.isPregnant] \u003d data.isPregnant\n    medicalHistory[MEDICAL_HISTORY_COLUMNS.otherDiseases] \u003d data.otherDiseases\n    return medicalHistory\n  }\n\n  static mapDataToDTO(data) {\n    return {\n      \u0027hasRegularMedicationIntake\u0027: data[MEDICAL_HISTORY_COLUMNS.hasRegularMedicationIntake],\n      \u0027regularMedications\u0027: data[MEDICAL_HISTORY_COLUMNS.regularMedications],\n      \u0027regularMedications\u0027: data[MEDICAL_HISTORY_COLUMNS.regularMedications],\n      \u0027hasAllergies\u0027: data[MEDICAL_HISTORY_COLUMNS.hasAllergies],\n      \u0027allergies\u0027: data[MEDICAL_HISTORY_COLUMNS.allergies],\n      \u0027hasBronchialAsthma\u0027: data[MEDICAL_HISTORY_COLUMNS.hasBronchialAsthma],\n      \u0027hasAids\u0027: data[MEDICAL_HISTORY_COLUMNS.hasAids],\n      \u0027hasViralHepatitis\u0027: data[MEDICAL_HISTORY_COLUMNS.hasViralHepatitis],\n      \u0027hasHemophilia\u0027: data[MEDICAL_HISTORY_COLUMNS.hasHemophilia],\n      \u0027doesDrugs\u0027: data[MEDICAL_HISTORY_COLUMNS.doesDrugs],\n      \u0027hasLeukemia\u0027: data[MEDICAL_HISTORY_COLUMNS.hasLeukemia],\n      \u0027hasAbnormalBloodPressure\u0027: data[MEDICAL_HISTORY_COLUMNS.hasAbnormalBloodPressure],\n      \u0027regularBloodPressureMeasures\u0027: data[MEDICAL_HISTORY_COLUMNS.regularBloodPressureMeasures],\n      \u0027bloodPressureUntilIncident\u0027: data[MEDICAL_HISTORY_COLUMNS.bloodPressureUntilIncident],\n      \u0027hasCardiovascularSystemDiseases\u0027: data[MEDICAL_HISTORY_COLUMNS.hasCardiovascularSystemDiseases],\n      \u0027hasDiabetes\u0027: data[MEDICAL_HISTORY_COLUMNS.hasDiabetes],\n      \u0027hasJointDiseases\u0027: data[MEDICAL_HISTORY_COLUMNS.hasJointDiseases],\n      \u0027isPregnant\u0027: data[MEDICAL_HISTORY_COLUMNS.isPregnant],\n      \u0027hasOtherDiseases\u0027: data[MEDICAL_HISTORY_COLUMNS.hasOtherDiseases],\n      \u0027otherDiseases\u0027: data[MEDICAL_HISTORY_COLUMNS.otherDiseases]\n    }\n  }\n}"},{"id":"875900d2-89de-427c-baeb-7fe761e99eb4","name":"1-PatientDataMapper","type":"server_js","source":"class PatientDataMapper {\n  static mapDataToTable(id, data) {\n    const patientData \u003d []\n    patientData[PATIENTS_DATA_COLUMNS.patientId] \u003d id\n    patientData[PATIENTS_DATA_COLUMNS.name] \u003d data.name\n    patientData[PATIENTS_DATA_COLUMNS.middleName] \u003d data.middleName\n    patientData[PATIENTS_DATA_COLUMNS.familyName] \u003d data.familyName\n    patientData[PATIENTS_DATA_COLUMNS.phone] \u003d data.phone\n    patientData[PATIENTS_DATA_COLUMNS.egn] \u003d data.egn\n    patientData[PATIENTS_DATA_COLUMNS.city] \u003d data.city\n    patientData[PATIENTS_DATA_COLUMNS.street] \u003d data.street\n    patientData[PATIENTS_DATA_COLUMNS.occupation] \u003d data.occupation\n    patientData[PATIENTS_DATA_COLUMNS.email] \u003d data.email\n    patientData[PATIENTS_DATA_COLUMNS.hasAllergies] \u003d data.hasAllergies\n    patientData[PATIENTS_DATA_COLUMNS.isSmoker] \u003d data.isSmoker\n    return patientData\n  }\n\n  static mapDataToDTO(data) {\n    return {\n      \u0027name\u0027: data[PATIENTS_DATA_COLUMNS.name],\n      \u0027middleName\u0027: data[PATIENTS_DATA_COLUMNS.middleName],\n      \u0027familyName\u0027: data[PATIENTS_DATA_COLUMNS.familyName],\n      \u0027phone\u0027: data[PATIENTS_DATA_COLUMNS.phone],\n      \u0027egn\u0027: data[PATIENTS_DATA_COLUMNS.egn],\n      \u0027city\u0027: data[PATIENTS_DATA_COLUMNS.city],\n      \u0027street\u0027: data[PATIENTS_DATA_COLUMNS.street],\n      \u0027occupation\u0027: data[PATIENTS_DATA_COLUMNS.occupation],\n      \u0027email\u0027: data[PATIENTS_DATA_COLUMNS.email],\n      \u0027hasAllergies\u0027: data[PATIENTS_DATA_COLUMNS.hasAllergies],\n      \u0027isSmoker\u0027: data[PATIENTS_DATA_COLUMNS.isSmoker],\n    }\n  }\n}"},{"id":"c96ef870-c6e2-4c84-8c01-fa1baf7a092a","name":"1-PatientMapper","type":"server_js","source":"class PatientMapper {\n  static mapDataToTable(id, data) {\n    const patient \u003d []\n    patient[PATIENTS_COLUMNS.id] \u003d id\n    patient[PATIENTS_COLUMNS.name] \u003d `${data.name} ${data.middleName} ${data.familyName}`\n    return patient\n  }\n}"},{"id":"227f22c7-277d-4357-8dac-7dfcaf7d6788","name":"2-MedicalHistoryRepository","type":"server_js","source":"class MedicalHistoryRepository {\n  static getById(id) {\n    return findRowsByValue(MEDICAL_HISTORY_SHEET, id)\n  }\n\n  static add(id, data) {\n    MEDICAL_HISTORY_SHEET.appendRow(MedicalHistoryMapper.mapDataToTable(id, data))\n  }\n\n  static edit(id, data) {\n    const rowIndex \u003d this.findRowIndexByPatientId(id)\n    if (rowIndex \u003d\u003d\u003d -1) {\n      throw { code: \u0027NOT_FOUND\u0027, message: `Row with id: ${id} was not found.` }\n    }\n\n    this.updateRow(rowIndex, MedicalHistoryMapper.mapDataToTable(id, data))\n  }\n\n  static updateRow(rowIndex, data) {\n    const range \u003d MEDICAL_HISTORY_SHEET.getRange(rowIndex + 1, 1, 1, data.length) // ranges start from 1?\n    range.setValues([data])\n  }\n\n  static findRowIndexByPatientId(patientId) {\n    const values \u003d MEDICAL_HISTORY_SHEET.getDataRange().getValues()\n    \n    for (let i \u003d 0; i \u003c values.length; i++) {\n      if (values[i][PATIENTS_DATA_COLUMNS.patientId] \u003d\u003d\u003d patientId) {\n        return i\n      }\n    }\n\n    return -1\n  }\n}"},{"id":"aeb7951c-68a7-4d35-ab5a-24d83e5af167","name":"2-PatientsDataRepository","type":"server_js","source":"class PatientsDataRepository {\n  static getById(id) {\n    return findRowsByValue(PATIENTS_DATA_SHEET, id)\n  }\n\n  static add(id, data) {\n    PATIENTS_DATA_SHEET.appendRow(PatientDataMapper.mapDataToTable(id, data))\n  }\n\n  static edit(id, data) {\n    const rowIndex \u003d this.findRowIndexByPatientId(id)\n    if (rowIndex \u003d\u003d\u003d -1) {\n      throw { code: \u0027NOT_FOUND\u0027, message: `Row with id: ${id} was not found.` }\n    }\n\n    this.updateRow(rowIndex, PatientDataMapper.mapDataToTable(id, data))\n  }\n\n  static updateRow(rowIndex, data) {\n    const range \u003d PATIENTS_DATA_SHEET.getRange(rowIndex + 1, 1, 1, data.length) // ranges start from 1?\n    range.setValues([data])\n  }\n\n  static findRowIndexByPatientId(patientId) {\n    const values \u003d PATIENTS_DATA_SHEET.getDataRange().getValues()\n    \n    for (let i \u003d 0; i \u003c values.length; i++) {\n      if (values[i][PATIENTS_DATA_COLUMNS.patientId] \u003d\u003d\u003d patientId) {\n        return i\n      }\n    }\n\n    return -1\n  }\n}"},{"id":"e788bb80-e6e9-46ea-8ba9-12fff08a2d8e","name":"2-PatientsRepository","type":"server_js","source":"class PatientsRepository {\n  static getAll() {\n    return PATIENTS_SHEET.getDataRange().getValues()\n  }\n\n  static add(id, data) {\n    PATIENTS_SHEET.appendRow(PatientMapper.mapDataToTable(id, data))\n  }\n\n  static edit(id, data) {\n    const rowIndex \u003d this.findRowIndexByPatientId(id)\n    if (rowIndex \u003d\u003d\u003d -1) {\n      throw { code: \u0027NOT_FOUND\u0027, message: `Row with id: ${id} was not found.` }\n    }\n\n    this.updateRow(rowIndex, PatientMapper.mapDataToTable(id, data))\n  }\n\n  static updateRow(rowIndex, data) {\n    const range \u003d PATIENTS_SHEET.getRange(rowIndex + 1, 1, 1, data.length) // ranges start from 1?\n    range.setValues([data])\n  }\n\n  static findRowIndexByPatientId(patientId) {\n    const values \u003d PATIENTS_SHEET.getDataRange().getValues()\n    \n    for (let i \u003d 0; i \u003c values.length; i++) {\n      if (values[i][PATIENTS_COLUMNS.id] \u003d\u003d\u003d patientId) {\n        return i\n      }\n    }\n\n    return -1\n  }\n}"},{"id":"4999ba0d-5913-45bb-9a29-ca8329275fb1","name":"3-MedicalHistoryService","type":"server_js","source":"class MedicalHistoryService {\n  static add(patientId, data) {\n    MedicalHistoryRepository.add(patientId, data)\n\n    return patientId\n  }\n}\n"},{"id":"7d23e524-0386-4f8a-8423-45e6a9639735","name":"3-PatientsService","type":"server_js","source":"class PatientService {\n  static add(data) {\n    this.checkIfPatientExists(data)\n    this.checkIfDataIsValid(data)\n\n    const patientId \u003d Utilities.getUuid()\n    PatientsRepository.add(patientId, data)\n    PatientsDataRepository.add(patientId, data)\n\n    return patientId\n  }\n\n  static checkIfPatientExists(data) {\n    const newPatientName \u003d `${data.name} ${data.middleName} ${data.familyName}`\n    const oldPatients \u003d PatientsRepository.getAll()\n\n    if (oldPatients?.find(([name, _id]) \u003d\u003e name \u003d\u003d\u003d newPatientName)) {\n      throw { code: \u0027CONFLICT\u0027, message: \u0027Patient already exists.\u0027 }\n    }\n  }\n\n  static edit(patientId, data) {\n    this.checkIfNameIsTaken(patientId, data)\n    this.checkIfDataIsValid(data)\n\n    PatientsRepository.edit(patientId, data)\n    PatientsDataRepository.edit(patientId, data)\n  }\n\n  static checkIfNameIsTaken(patientId, data) {\n    const newName \u003d `${data.name} ${data.middleName} ${data.familyName}`\n    const oldPatients \u003d PatientsRepository.getAll()\n\n    if (oldPatients?.find(([name, id]) \u003d\u003e name \u003d\u003d\u003d newName \u0026\u0026 id !\u003d\u003d patientId)) {\n      throw { code: \u0027CONFLICT\u0027, message: \u0027Edited name refers to another patient.\u0027 }\n    }\n  }\n\n  static checkIfDataIsValid(data) {\n    const missingFields \u003d []\n    \n    if (!data.name) {\n      missingFields.push(\u0027name\u0027)\n    }\n    if (!data.familyName) {\n      missingFields.push(\u0027familyName\u0027)\n    }\n    if (!data.egn) {\n      missingFields.push(\u0027egn\u0027)\n    }\n    if (!data.hasAllergies) {\n      missingFields.push(\u0027hasAllergies\u0027)\n    }\n\n    if (missingFields.length) {\n      throw { code: \u0027BAD_REQUEST\u0027, message: `One or more required fields are missing. ${missingFields.join(\u0027, \u0027)}` }\n    }\n  }\n}"},{"id":"fd971c0e-7556-43c1-9203-4371020597de","name":"4-controller","type":"server_js","source":"// TODO: hash the data in transfer\n\nfunction doGet() {\n  const template \u003d HtmlService.createTemplateFromFile(\u0027index\u0027)\n  return HtmlService.createHtmlOutput(template.evaluate().getContent())\n}\n\nfunction addPatient(data) {\n  try {\n    const patientId \u003d PatientService.add(data)\n    return { success: true, patientId }\n  }\n  catch(error) {\n    Logger.log(error)\n    return { success: false, error}\n  }\n}\n\nfunction getAllPatients() {\n  const patients \u003d PatientsRepository.getAll()\n  Logger.log(`${patients.length} patients loaded`)\n  return patients\n}\n\nfunction getPatientById(id) {\n  const patients \u003d PatientsDataRepository.getById(id)\n  Logger.log(`Patient with id: ${id} loaded`)\n  return PatientDataMapper.mapDataToDTO(patients[0])\n}\n\nfunction editPatient(patientId, data) {\n  try {\n    PatientService.edit(patientId, data)\n    return { success: true, patientId }\n  }\n  catch(error) {\n    Logger.log(error)\n    return { success: false, error }\n  }\n}\n\nfunction addMedicalHistory(patientId, data) {\n  try {\n    MedicalHistoryService.add(patientId, data)\n    return { success: true, patientId }\n  }\n  catch(error) {\n    Logger.log(error)\n    return { success: false, error }\n  }\n}\n\nfunction getMedicalHistory(id) {\n  const medicalHistory \u003d MedicalHistoryRepository.getById(id)\n  Logger.log(`Medical data for patent with id: ${id} loaded`)\n  return MedicalHistoryMapper.mapDataToDTO(medicalHistory)\n}"},{"id":"a301df60-1bc4-465c-acc3-aa88bce3d2df","name":"index","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n\n    \u003c!-- Bootstrap --\u003e\n    \u003clink href\u003d\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel\u003d\"stylesheet\" integrity\u003d\"sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM\" crossorigin\u003d\"anonymous\"\u003e\n  \u003c/head\u003e\n  \u003cbody class\u003d\"container\"\u003e\n    \u003ch1 class\u003d\"row\"\u003eOutpatient Card\u003c/h1\u003e\n\n    \u003c?!\u003d loadTemplate(\u0027templ-patient-select\u0027) ?\u003e\n    \u003c?!\u003d loadTemplate(\u0027templ-new-patient-form\u0027) ?\u003e\n    \u003c?!\u003d loadTemplate(\u0027templ-edit-patient-form\u0027) ?\u003e\n    \u003c?!\u003d loadTemplate(\u0027templ-medical-history-form\u0027) ?\u003e\n    \u003c?!\u003d loadTemplate(\u0027script-state-controller\u0027) ?\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n"},{"id":"675aa932-f3ef-4ef0-b3e1-abfe0f85bfc0","name":"script-state-controller","type":"html","source":"\u003cscript\u003e\n  ((w, d) \u003d\u003e {\n    w.addEventListener(\u0027storage\u0027, toggleUiIfPatient)\n\n    function toggleUiIfPatient() {\n      console.log(checkIfHasPatient())\n      if (!checkIfHasPatient()) {\n        return\n      }\n\n      d.querySelector(\u0027#edit_patient_form\u0027)?.classList.remove(\u0027d-none\u0027)\n      d.querySelector(\u0027#medical_history_form\u0027)?.classList.remove(\u0027d-none\u0027)\n      d.querySelector(\u0027#new_patient_form\u0027)?.classList.add(\u0027d-none\u0027)\n    }\n\n    function checkIfHasPatient() {\n      return Boolean(w.sessionStorage.getItem(\u0027patientId\u0027))\n    }\n  })(window, document)\n\u003c/script\u003e"},{"id":"4c8f7b0a-2253-47d6-a0cd-291276144a98","name":"templ-edit-patient-form","type":"html","source":"\u003cform id\u003d\"edit_patient_form\" class\u003d\"container my-4 d-none\"\u003e\n  \u003cheader class\u003d\"row\"\u003e\n    \u003ch2 class\u003d\"col px-0\"\u003eEdit patient\u003c/h2\u003e\n    \u003cdiv class\u003d\"spinner spinner-border ms-auto d-none\" role\u003d\"status\" aria-hidden\u003d\"true\"\u003e\u003c/div\u003e\n  \u003c/header\u003e\n\n  \u003cfieldset class\u003d\"row mb-2\"\u003e\n    \u003cinput class\u003d\"col me-2\" type\u003d\"text\" name\u003d\"name\" placeholder\u003d\"Name\" required\u003e\n    \u003cinput class\u003d\"col me-2\" type\u003d\"text\" name\u003d\"middleName\" placeholder\u003d\"Middle name\"\u003e\n    \u003cinput class\u003d\"col\" type\u003d\"text\" name\u003d\"familyName\" placeholder\u003d\"Family name\" required\u003e\n  \u003c/fieldset\u003e\n\n  \u003cfieldset class\u003d\"row mb-2\"\u003e\n    \u003cinput class\u003d\"col me-2\" type\u003d\"tel\" name\u003d\"phone\" placeholder\u003d\"Telephone\"\u003e\n    \u003cinput class\u003d\"col\" type\u003d\"text\" name\u003d\"egn\" placeholder\u003d\"EGN\" required maxlength\u003d\"10\" minlength\u003d\"10\"\u003e\n  \u003c/fieldset\u003e\n\n  \u003cfieldset class\u003d\"row mb-2\"\u003e\n    \u003cinput class\u003d\"col me-2\" type\u003d\"text\" name\u003d\"city\" placeholder\u003d\"City\"\u003e\n    \u003cinput class\u003d\"col\" type\u003d\"text\" name\u003d\"street\" placeholder\u003d\"Street\"\u003e\n  \u003c/fieldset\u003e\n\n  \u003cfieldset class\u003d\"row mb-2\"\u003e\n    \u003cinput class\u003d\"col me-2\" type\u003d\"text\" name\u003d\"occupation\" placeholder\u003d\"Occupation\"\u003e\n    \u003cinput class\u003d\"col\" type\u003d\"email\" name\u003d\"email\" placeholder\u003d\"Email\"\u003e\n  \u003c/fieldset\u003e\n\n  \u003cdiv class\u003d\"row mb-2\"\u003e\n    \u003cfieldset class\u003d\"col border-start me-2\"\u003e\n      \u003cp class\u003d\"mb-0\"\u003eAllergies\u003c/p\u003e\n      \u003clabel for\u003d\"allergies1\"\u003eYes\u003c/label\u003e\n      \u003cinput type\u003d\"radio\" id\u003d\"allergies1\" name\u003d\"hasAllergies\" value\u003d\"1\" required\u003e\n      \u003clabel class\u003d\"ms-2\" for\u003d\"allergies2\"\u003eNo\u003c/label\u003e\n      \u003cinput type\u003d\"radio\" id\u003d\"allergies2\" name\u003d\"hasAllergies\" value\u003d\"0\" required\u003e\n    \u003c/fieldset\u003e\n\n    \u003cfieldset class\u003d\"col border-start\"\u003e\n      \u003cp class\u003d\"mb-0\"\u003eSmoker\u003c/p\u003e\n      \u003clabel for\u003d\"smoker1\"\u003eYes\u003c/label\u003e\n      \u003cinput type\u003d\"radio\" id\u003d\"smoker1\" name\u003d\"isSmoker\" value\u003d\"1\"\u003e\n      \u003clabel class\u003d\"ms-2\" for\u003d\"smoker2\"\u003eNo\u003c/label\u003e\n      \u003cinput type\u003d\"radio\" id\u003d\"smoker2\" name\u003d\"isSmoker\" value\u003d\"0\"\u003e\n    \u003c/fieldset\u003e\n  \u003c/div\u003e\n\n  \u003cdiv class\u003d\u0027row justify-content-end\u0027\u003e\n    \u003cinput class\u003d\"col-2\" type\u003d\"submit\" value\u003d\"Save\"\u003e\n  \u003c/div\u003e\n\n  \u003cdiv class\u003d\"spinner row align-items-center d-none\"\u003e\n    \u003cstrong\u003eLoading...\u003c/strong\u003e\n    \u003cdiv class\u003d\"spinner-border ms-auto\" role\u003d\"status\" aria-hidden\u003d\"true\"\u003e\u003c/div\u003e\n  \u003c/div\u003e\n  \n  \u003cdiv class\u003d\u0027row mt-4\u0027\u003e\n    \u003cdiv class\u003d\"alert alert-success d-none\" role\u003d\"alert\"\u003ePatient data saved\u003c/div\u003e\n    \u003cdiv class\u003d\"alert alert-danger d-none\" role\u003d\"alert\" data-default-text\u003d\"Something went wrong\"\u003eSomething went wrong\u003c/div\u003e\n  \u003c/div\u003e\n\u003c/form\u003e\n\n\u003cscript\u003e\n  ((w, d, g) \u003d\u003e {\n    w.addEventListener(\u0027storage\u0027, loadPatientData)\n\n    function loadPatientData() {\n      toggleHeaderSpinner()\n      const patientId \u003d w.sessionStorage.getItem(\u0027patientId\u0027)\n      g.script.run.withSuccessHandler(handlePatientData).getPatientById(patientId)\n    }\n\n    function handlePatientData(data) {\n      d.querySelector(\u0027#edit_patient_form\u0027).reset()\n      populateForm(data)\n      clearAlerts()\n      toggleHeaderSpinner()\n    }\n\n    function populateForm(patientData) {\n      const { elements } \u003d d.querySelector(\u0027#edit_patient_form\u0027)\n\n      for (const [key, value] of Object.entries(patientData)) {\n        const field \u003d elements.namedItem(key)\n        field \u0026\u0026 (field.value \u003d value)\n      }\n    }\n\n    d.querySelector(\u0027#edit_patient_form\u0027).addEventListener(\u0027submit\u0027, editExistingPatient)\n\n    function editExistingPatient() {\n      event.preventDefault()\n      clearAlerts()\n      toggleFormSpinner()\n\n      const formData \u003d new FormData(event.target)\n      const patientId \u003d w.sessionStorage.getItem(\u0027patientId\u0027)\n      g.script.run.withSuccessHandler(handleSubmissionResponse)\n        .editPatient(patientId, Object.fromEntries(formData))\n    }\n\n    function handleSubmissionResponse(response) {\n      toggleFormSpinner()\n\n      if (response.error) {\n        const alert \u003d d.querySelector(\u0027#edit_patient_form .alert-danger\u0027)\n        alert.innerText \u003d alert.dataset.defaultText\n        alert.innerText \u003d response.error?.message ?\n          response.error?.message : alert.innerText\n        alert.classList.remove(\u0027d-none\u0027)\n      }\n      else {\n        d.querySelector(\u0027#edit_patient_form .alert-success\u0027).classList.remove(\u0027d-none\u0027)\n        storePatientId(response.patientId)\n      }\n    }\n\n    function storePatientId(id) {\n      w.sessionStorage.setItem(\u0027patientId\u0027, id)\n      w.dispatchEvent(new Event(\u0027storage\u0027))\n    }\n\n    function clearAlerts() {\n      d.querySelectorAll(\u0027#edit_patient_form .alert\u0027).forEach(a \u003d\u003e a.classList.add(\u0027d-none\u0027))\n    }\n\n    function toggleHeaderSpinner() {\n      d.querySelector(\u0027#edit_patient_form header .spinner\u0027).classList.toggle(\u0027d-none\u0027)\n    }\n    \n    function toggleFormSpinner() {\n      d.querySelector(\u0027#edit_patient_form \u003e .spinner\u0027).classList.toggle(\u0027d-none\u0027)\n    }\n  })(window, document, google)\n\u003c/script\u003e"},{"id":"0176e5bd-73e1-44d8-8382-d5dc46050441","name":"templ-medical-history-form","type":"html","source":"\u003cform id\u003d\"medical_history_form\" class\u003d\"container my-4 d-none\"\u003e\n  \u003cheader class\u003d\"row\"\u003e\n    \u003ch2 class\u003d\"col px-0\"\u003eMedical history\u003c/h2\u003e\n    \u003cdiv class\u003d\"spinner spinner-border ms-auto d-none\" role\u003d\"status\" aria-hidden\u003d\"true\"\u003e\u003c/div\u003e\n  \u003c/header\u003e\n\n  \u003cdiv class\u003d\"row\"\u003e\n    \u003cdiv class\u003d\"col row mb-2\"\u003e\n      \u003cfieldset class\u003d\"border-start me-2 mb-2 if-checked-enable\"\u003e\n        \u003cp class\u003d\"mb-0\"\u003e1. Regular medication intake\u003c/p\u003e\n        \u003clabel for\u003d\"hasRegularMedicationIntake\"\u003eYes\u003c/label\u003e\n        \u003cinput type\u003d\"checkbox\" id\u003d\"hasRegularMedicationIntake\" name\u003d\"hasRegularMedicationIntake\" value\u003d\"1\"\u003e\n\n        \u003ctextarea class\u003d\"d-block w-100 me-2 px-3\" name\u003d\"regularMedications\" placeholder\u003d\"Medications\" disabled\u003d\"true\"\u003e\u003c/textarea\u003e\n      \u003c/fieldset\u003e\n\n      \u003cfieldset class\u003d\"border-start me-2 mb-2 if-checked-enable\"\u003e\n        \u003cp class\u003d\"mb-0\"\u003e2. Allergy \u003csmall\u003e(skin rash, hay fever, allergy to medications, cosmetics, foods, anaphylactic reaction)\u003c/small\u003e\u003c/p\u003e\n        \u003clabel for\u003d\"hasAllergies\"\u003eYes\u003c/label\u003e\n        \u003cinput type\u003d\"checkbox\" id\u003d\"hasAllergies\" name\u003d\"hasAllergies\" value\u003d\"1\"\u003e\n\n        \u003ctextarea class\u003d\"d-block w-100 me-2 px-3\" name\u003d\"allergies\" id\u003d\"allergies\" placeholder\u003d\"Allergies\" disabled\u003d\"true\"\u003e\u003c/textarea\u003e\n      \u003c/fieldset\u003e\n\n      \u003cfieldset class\u003d\"border-start me-2 mb-2\"\u003e\n        \u003cp class\u003d\"mb-0\"\u003e3. Bronchial Asthma\u003c/p\u003e\n        \u003clabel for\u003d\"hasBronchialAsthma\"\u003eYes\u003c/label\u003e\n        \u003cinput type\u003d\"checkbox\" id\u003d\"hasBronchialAsthma\" name\u003d\"hasBronchialAsthma\" value\u003d\"1\"\u003e\n      \u003c/fieldset\u003e\n\n      \u003cfieldset class\u003d\"border-start me-2 mb-2\"\u003e\n        \u003cp class\u003d\"mb-0\"\u003e4. Aids\u003c/p\u003e\n        \u003clabel for\u003d\"hasAids\"\u003eYes\u003c/label\u003e\n        \u003cinput type\u003d\"checkbox\" id\u003d\"hasAids\" name\u003d\"hasAids\" value\u003d\"1\"\u003e\n      \u003c/fieldset\u003e\n\n      \u003cfieldset class\u003d\"border-start me-2 mb-2\"\u003e\n        \u003cp class\u003d\"mb-0\"\u003e5. Viral Hepatitis\u003c/p\u003e\n        \u003clabel for\u003d\"hasViralHepatitis\"\u003eYes\u003c/label\u003e\n        \u003cinput type\u003d\"checkbox\" id\u003d\"hasViralHepatitis\" name\u003d\"hasViralHepatitis\" value\u003d\"1\"\u003e\n      \u003c/fieldset\u003e\n\n      \u003cfieldset class\u003d\"border-start me-2 mb-2\"\u003e\n        \u003cp class\u003d\"mb-0\"\u003e6. Hemophilia\u003c/p\u003e\n        \u003clabel for\u003d\"hasHemophilia\"\u003eYes\u003c/label\u003e\n        \u003cinput type\u003d\"checkbox\" id\u003d\"hasHemophilia\" name\u003d\"hasHemophilia\" value\u003d\"1\"\u003e\n      \u003c/fieldset\u003e\n\n      \u003cfieldset class\u003d\"col border-start me-2\"\u003e\n        \u003cp class\u003d\"mb-0\"\u003e7. Use of drugs \u003csmall\u003e(There are medications and medicinal products in routine dental practice that are incompatible with some drugs and may be dangerous to the patient\u0027s health)\u003c/small\u003e\u003c/p\u003e\n        \u003clabel for\u003d\"doesDrugs\"\u003eYes\u003c/label\u003e\n        \u003cinput type\u003d\"checkbox\" id\u003d\"doesDrugs\" name\u003d\"doesDrugs\" value\u003d\"1\"\u003e\n      \u003c/fieldset\u003e\n    \u003c/div\u003e\n\n    \u003cdiv class\u003d\"col row mb-2\"\u003e\n      \u003cfieldset class\u003d\"border-start me-2 mb-2\"\u003e\n        \u003cp class\u003d\"mb-0\"\u003e8. Leukemia\u003c/p\u003e\n        \u003clabel for\u003d\"hasLeukemia\"\u003eYes\u003c/label\u003e\n        \u003cinput type\u003d\"checkbox\" id\u003d\"hasLeukemia\" name\u003d\"hasLeukemia\" value\u003d\"1\"\u003e\n      \u003c/fieldset\u003e\n      \n      \u003cfieldset class\u003d\"border-start me-2 mb-2 if-checked-enable\"\u003e\n        \u003cp class\u003d\"mb-0\"\u003e9. High/low blood pressure\u003c/p\u003e\n        \u003clabel for\u003d\"hasAbnormalBloodPressure\"\u003eYes\u003c/label\u003e\n        \u003cinput type\u003d\"checkbox\" id\u003d\"hasAbnormalBloodPressure\" name\u003d\"hasAbnormalBloodPressure\" value\u003d\"1\"\u003e\n\n        \u003cinput class\u003d\"d-block w-100 px-3 mb-1\" type\u003d\"text\" id\u003d\"regularBloodPressureMeasures\" name\u003d\"regularBloodPressureMeasures\" placeholder\u003d\"Usual values\" disabled\u003d\"true\"\u003e\n        \u003cinput class\u003d\"d-block w-100 px-3\" type\u003d\"text\" id\u003d\"bloodPressureUntilIncident\" name\u003d\"bloodPressureUntilIncident\" placeholder\u003d\"Incident to\" disabled\u003d\"true\"\u003e\n      \u003c/fieldset\u003e\n\n      \u003cfieldset class\u003d\"border-start me-2 mb-2\"\u003e\n        \u003cp class\u003d\"mb-0\"\u003e10. Diseases of the cardiovascular system \u003csmall\u003e(arrhythmia, previous heart attack, stroke)\u003c/small\u003e\u003c/p\u003e\n        \u003clabel for\u003d\"hasCardiovascularSystemDiseases\"\u003eYes\u003c/label\u003e\n        \u003cinput type\u003d\"checkbox\" id\u003d\"hasCardiovascularSystemDiseases\" name\u003d\"hasCardiovascularSystemDiseases\" value\u003d\"1\"\u003e\n      \u003c/fieldset\u003e\n\n      \u003cfieldset class\u003d\"border-start me-2 mb-2\"\u003e\n        \u003cp class\u003d\"mb-0\"\u003e11. Diabetes\u003c/p\u003e\n        \u003clabel for\u003d\"hasDiabetes\"\u003eYes\u003c/label\u003e\n        \u003cinput type\u003d\"checkbox\" id\u003d\"hasDiabetes\" name\u003d\"hasDiabetes\" value\u003d\"1\"\u003e\n      \u003c/fieldset\u003e\n\n      \u003cfieldset class\u003d\"border-start me-2 mb-2\"\u003e\n        \u003cp class\u003d\"mb-0\"\u003e11. Joint diseases/joint prostheses/arthritis\u003c/p\u003e\n        \u003clabel for\u003d\"hasJointDiseases\"\u003eYes\u003c/label\u003e\n        \u003cinput type\u003d\"checkbox\" id\u003d\"hasJointDiseases\" name\u003d\"hasJointDiseases\" value\u003d\"1\"\u003e\n      \u003c/fieldset\u003e\n\n      \u003cfieldset class\u003d\"border-start me-2 mb-2\"\u003e\n        \u003cp class\u003d\"mb-0\"\u003e12. Pregnancy/lactation\u003c/p\u003e\n        \u003clabel for\u003d\"isPregnant\"\u003eYes\u003c/label\u003e\n        \u003cinput type\u003d\"checkbox\" id\u003d\"isPregnant\" name\u003d\"isPregnant\" value\u003d\"1\"\u003e\n      \u003c/fieldset\u003e\n\n      \u003cfieldset class\u003d\"border-start me-2 mb-2 if-checked-enable\"\u003e\n        \u003cp class\u003d\"mb-0\"\u003eOther diseases:\u003c/p\u003e\n        \u003clabel for\u003d\"hasOtherDiseases\"\u003eYes\u003c/label\u003e\n        \u003cinput type\u003d\"checkbox\" id\u003d\"hasOtherDiseases\" name\u003d\"hasOtherDiseases\" value\u003d\"1\"\u003e\n\n        \u003ctextarea class\u003d\"d-block w-100 me-2 px-3\" name\u003d\"otherDiseases\" id\u003d\"otherDiseases\" placeholder\u003d\"Diseases\" disabled\u003d\"true\"\u003e\u003c/textarea\u003e\n      \u003c/fieldset\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003cdiv class\u003d\u0027row justify-content-end\u0027\u003e\n    \u003cinput class\u003d\"col-2\" type\u003d\"submit\" value\u003d\"Save\"\u003e\n  \u003c/div\u003e\n\n  \u003cdiv class\u003d\"spinner row align-items-center d-none\"\u003e\n    \u003cstrong\u003eLoading...\u003c/strong\u003e\n    \u003cdiv class\u003d\"spinner-border ms-auto\" role\u003d\"status\" aria-hidden\u003d\"true\"\u003e\u003c/div\u003e\n  \u003c/div\u003e\n  \n  \u003cdiv class\u003d\u0027row mt-4\u0027\u003e\n    \u003cdiv class\u003d\"alert alert-success d-none\" role\u003d\"alert\"\u003eMedical history saved\u003c/div\u003e\n    \u003cdiv class\u003d\"alert alert-danger d-none\" role\u003d\"alert\" data-default-text\u003d\"Something went wrong\"\u003eSomething went wrong\u003c/div\u003e\n  \u003c/div\u003e\n\u003c/form\u003e\n\n\u003cscript\u003e\n  ((w, d, g) \u003d\u003e {\n    w.addEventListener(\u0027storage\u0027, loadMedicalHistory)\n\n    function loadMedicalHistory() {\n      console.log(\u0027todo\u0027)\n    }\n\n    d.querySelectorAll(\u0027.if-checked-enable\u0027).forEach(fs \u003d\u003e {\n      const additionalInfoFields \u003d fs.querySelectorAll(\u0027input[disabled], textarea[disabled]\u0027)\n      fs.querySelector(\u0027input[type\u003dcheckbox]\u0027).addEventListener(\u0027change\u0027, event \u003d\u003e {\n        additionalInfoFields.forEach(f \u003d\u003e f.disabled \u003d !event.target.checked)\n      })\n    })\n\n    // TODO: add the save/edit logic\n  })(window, document, google)\n\u003c/script\u003e"},{"id":"11a3e9bc-ca08-4ccc-8451-6a5e5097eace","name":"templ-new-patient-form","type":"html","source":"\u003cform id\u003d\"new_patient_form\" class\u003d\"container my-4\"\u003e\n  \u003cheader class\u003d\"row\"\u003e\n    \u003ch2 class\u003d\"col px-0\"\u003eNew patient\u003c/h2\u003e\n  \u003c/header\u003e\n\n  \u003cfieldset class\u003d\"row mb-2\"\u003e\n    \u003cinput class\u003d\"col me-2\" type\u003d\"text\" name\u003d\"name\" placeholder\u003d\"Name\" required\u003e\n    \u003cinput class\u003d\"col me-2\" type\u003d\"text\" name\u003d\"middleName\" placeholder\u003d\"Middle name\"\u003e\n    \u003cinput class\u003d\"col\" type\u003d\"text\" name\u003d\"familyName\" placeholder\u003d\"Family name\" required\u003e\n  \u003c/fieldset\u003e\n\n  \u003cfieldset class\u003d\"row mb-2\"\u003e\n    \u003cinput class\u003d\"col me-2\" type\u003d\"tel\" name\u003d\"phone\" placeholder\u003d\"Telephone\"\u003e\n    \u003cinput class\u003d\"col\" type\u003d\"text\" name\u003d\"egn\" placeholder\u003d\"EGN\" required maxlength\u003d\"10\" minlength\u003d\"10\"\u003e\n  \u003c/fieldset\u003e\n\n  \u003cfieldset class\u003d\"row mb-2\"\u003e\n    \u003cinput class\u003d\"col me-2\" type\u003d\"text\" name\u003d\"city\" placeholder\u003d\"City\"\u003e\n    \u003cinput class\u003d\"col\" type\u003d\"text\" name\u003d\"street\" placeholder\u003d\"Street\"\u003e\n  \u003c/fieldset\u003e\n\n  \u003cfieldset class\u003d\"row mb-2\"\u003e\n    \u003cinput class\u003d\"col me-2\" type\u003d\"text\" name\u003d\"occupation\" placeholder\u003d\"Occupation\"\u003e\n    \u003cinput class\u003d\"col\" type\u003d\"email\" name\u003d\"email\" placeholder\u003d\"Email\"\u003e\n  \u003c/fieldset\u003e\n\n  \u003cdiv class\u003d\"row mb-2\"\u003e\n    \u003cfieldset class\u003d\"col border-start me-2\"\u003e\n      \u003cp class\u003d\"mb-0\"\u003eAllergies\u003c/p\u003e\n      \u003clabel for\u003d\"allergies1\"\u003eYes\u003c/label\u003e\n      \u003cinput type\u003d\"radio\" id\u003d\"allergies1\" name\u003d\"hasAllergies\" value\u003d\"1\" required\u003e\n      \u003clabel class\u003d\"ms-2\" for\u003d\"allergies2\"\u003eNo\u003c/label\u003e\n      \u003cinput type\u003d\"radio\" id\u003d\"allergies2\" name\u003d\"hasAllergies\" value\u003d\"0\" required\u003e\n    \u003c/fieldset\u003e\n\n    \u003cfieldset class\u003d\"col border-start\"\u003e\n      \u003cp class\u003d\"mb-0\"\u003eSmoker\u003c/p\u003e\n      \u003clabel for\u003d\"smoker1\"\u003eYes\u003c/label\u003e\n      \u003cinput type\u003d\"radio\" id\u003d\"smoker1\" name\u003d\"isSmoker\" value\u003d\"1\"\u003e\n      \u003clabel class\u003d\"ms-2\" for\u003d\"smoker2\"\u003eNo\u003c/label\u003e\n      \u003cinput type\u003d\"radio\" id\u003d\"smoker2\" name\u003d\"isSmoker\" value\u003d\"0\"\u003e\n    \u003c/fieldset\u003e\n  \u003c/div\u003e\n\n  \u003cdiv class\u003d\u0027row justify-content-end\u0027\u003e\n    \u003cinput class\u003d\"col-2\" type\u003d\"submit\" value\u003d\"Save\"\u003e\n  \u003c/div\u003e\n\n  \u003cdiv class\u003d\"spinner row align-items-center d-none\"\u003e\n    \u003cstrong\u003eLoading...\u003c/strong\u003e\n    \u003cdiv class\u003d\"spinner-border ms-auto\" role\u003d\"status\" aria-hidden\u003d\"true\"\u003e\u003c/div\u003e\n  \u003c/div\u003e\n  \n  \u003cdiv class\u003d\u0027row mt-4\u0027\u003e\n    \u003cdiv class\u003d\"alert alert-danger d-none\" role\u003d\"alert\" data-default-text\u003d\"Something went wrong\"\u003eSomething went wrong\u003c/div\u003e\n  \u003c/div\u003e\n\u003c/form\u003e\n\n\u003cscript\u003e\n  ((w, d, g) \u003d\u003e {\n    d.querySelector(\u0027#new_patient_form\u0027).addEventListener(\u0027submit\u0027, addNewPatient)\n\n    function addNewPatient(event) {\n      event.preventDefault()\n      clearAlerts()\n      toggleFormSpinner()\n\n      const formData \u003d new FormData(event.target)\n      g.script.run.withSuccessHandler(handleSubmissionResponse)\n        .addPatient(Object.fromEntries(formData))\n    }\n\n    function handleSubmissionResponse(response) {\n      toggleFormSpinner()\n\n      if (response.error) {\n        const alert \u003d d.querySelector(\u0027#new_patient_form .alert-danger\u0027)\n        alert.innerText \u003d alert.dataset.defaultText\n        alert.innerText \u003d response.error?.message ?\n          response.error?.message : alert.innerText\n        alert.classList.remove(\u0027d-none\u0027)\n      }\n      else {\n        storePatientId(response.patientId)\n      }\n    }\n\n    function storePatientId(id) {\n      w.sessionStorage.setItem(\u0027patientId\u0027, id)\n      w.dispatchEvent(new Event(\u0027storage\u0027))\n    }\n\n    function clearAlerts() {\n      d.querySelectorAll(\u0027#new_patient_form .alert\u0027).forEach(a \u003d\u003e a.classList.add(\u0027d-none\u0027))\n    }\n    \n    function toggleFormSpinner() {\n      d.querySelector(\u0027#new_patient_form .spinner\u0027).classList.toggle(\u0027d-none\u0027)\n    }\n  })(window, document, google)\n\u003c/script\u003e"},{"id":"00bc5b98-00c5-46a0-ae95-71bc9f81ce39","name":"templ-patient-select","type":"html","source":"\u003cform id\u003d\"previous_patients\" class\u003d\"container my-4\"\u003e\n  \u003cfieldset class\u003d\"row mb-2\"\u003e\n    \u003clabel class\u003d\"col border-start me-2\" for\u003d\"patients\"\u003eChoose a petient:\u003c/label\u003e\n    \u003cdiv id\u003d\"spinner\" class\u003d\"spinner-border ms-auto d-none me-2\" role\u003d\"status\" aria-hidden\u003d\"true\"\u003e\u003c/div\u003e\n    \u003cselect class\u003d\"col-6 py-1\" name\u003d\"patients\" id\u003d\"patients\" disabled\u003e\n      \u003coption value\u003d\"\"\u003ePrevious patients\u003c/option\u003e\n    \u003c/select\u003e\n  \u003c/fieldset\u003e\n\n  \u003cdiv class\u003d\"row justify-content-end\"\u003e\n    \u003cinput class\u003d\"col-2\" type\u003d\"submit\" value\u003d\"Select\" disabled\u003e\n  \u003c/div\u003e\n  \n  \u003cdiv class\u003d\"row mt-4\"\u003e\n    \u003cdiv class\u003d\"alert alert-success d-none\" role\u003d\"alert\"\u003eNew patient added\u003c/div\u003e\n    \u003cdiv class\u003d\"alert alert-danger d-none\" role\u003d\"alert\"\u003eSomething went wrong\u003c/div\u003e\n  \u003c/div\u003e\n\u003c/form\u003e\n\n\u003cscript\u003e\n  ((w, d, g) \u003d\u003e {\n    g.script.run.withSuccessHandler(loadOldPetients).getAllPatients()\n    togglePpSpinner()\n\n    function loadOldPetients(data) {\n      const patientSelect \u003d d.querySelector(\u0027#previous_patients #patients\u0027)\n      const patients \u003d data.filter(p \u003d\u003e p[0] !\u003d\u003d \u0027name\u0027)\n\n      for (let patient of patients) {\n        patientSelect.appendChild(createPatientOption(patient))\n      }\n\n      patientSelect.disabled \u003d !patients.length\n      togglePpSpinner()\n    }\n\n    function createPatientOption(patient) {\n      const [name, id] \u003d patient\n      const newOption \u003d d.createElement(\u0027option\u0027)\n      newOption.value \u003d id\n      newOption.innerText \u003d name\n      return newOption\n    }\n\n    d.querySelector(\u0027#patients\u0027).addEventListener(\u0027change\u0027, selectParient)\n\n    function selectParient() {\n      d.querySelector(\u0027#previous_patients input[type\u003dsubmit]\u0027).disabled \u003d false\n    }\n    \n    d.querySelector(\u0027#previous_patients\u0027).addEventListener(\u0027submit\u0027, handleSubmit)\n\n    function handleSubmit(event) {\n      event.preventDefault()\n      storePatientId(event.target.patients.value)\n    }\n\n    function storePatientId(id) {\n      w.sessionStorage.setItem(\u0027patientId\u0027, id)\n      w.dispatchEvent(new Event(\u0027storage\u0027))\n    }\n\n    function togglePpSpinner() {\n      d.querySelector(\u0027#previous_patients #spinner\u0027).classList.toggle(\u0027d-none\u0027)\n    }\n  })(window, document, google)\n\u003c/script\u003e"}]}